"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var Supercluster=_interopDefault(require("supercluster")),react=require("react"),reactMapGl=require("@urbica/react-map-gl");function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var point=function(e,t){return void 0===t&&(t={}),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:e}}},childrenKeys=function(e){return react.Children.toArray(e).map((function(e){return e.key}))},shallowCompareChildren=function(e,t){if(react.Children.count(e)!==react.Children.count(t))return!1;var r=childrenKeys(e),n=new Set(childrenKeys(t));return r.every((function(e){return n.has(e)}))},Cluster=function(e){function t(t){var r;return _defineProperty(_assertThisInitialized(r=e.call(this,t)||this),"_map",void 0),_defineProperty(_assertThisInitialized(r),"_cluster",void 0),_defineProperty(_assertThisInitialized(r),"_createCluster",(function(e){var t=e.minZoom,n=e.maxZoom,i=e.radius,o=e.extent,s=e.nodeSize,a=e.children,u=e.reduce,c=e.map,p=new Supercluster({minZoom:t,maxZoom:n,radius:i,extent:o,nodeSize:s,reduce:u,map:c}),l=react.Children.map(a,(function(e){return point([e.props.longitude,e.props.latitude],e)}));p.load(l),r._cluster=p})),_defineProperty(_assertThisInitialized(r),"_recalculate",(function(){var e=r._map.getZoom(),t=r._map.getBounds().toArray(),n=t[0].concat(t[1]),i=r._cluster.getClusters(n,Math.round(e));r.setState((function(){return{clusters:i}}))})),_defineProperty(_assertThisInitialized(r),"_renderCluster",(function(e){var t=e.geometry.coordinates,n=t[0],i=t[1],o=e.properties,s=o.cluster_id,a=o.point_count,u=o.point_count_abbreviated;return react.createElement(r.props.component,{longitude:n,latitude:i,clusterId:s,pointCount:a,pointCountAbbreviated:u,key:"cluster-"+e.properties.cluster_id})})),r.state={clusters:[]},r}_inheritsLoose(t,e);var r=t.prototype;return r.componentDidMount=function(){this._createCluster(this.props),this._recalculate(),this._map.on("moveend",this._recalculate)},r.componentDidUpdate=function(e){(e.minZoom!==this.props.minZoom||e.maxZoom!==this.props.maxZoom||e.radius!==this.props.radius||e.extent!==this.props.extent||e.nodeSize!==this.props.nodeSize||!shallowCompareChildren(e.children,this.props.children))&&(this._createCluster(this.props),this._recalculate())},r.componentWillUnmount=function(){this._map&&this._map.getStyle()&&this._map.off("moveend",this._recalculate)},r.getCluster=function(){return this._cluster},r.render=function(){var e=this;return react.createElement(reactMapGl.MapContext.Consumer,{},(function(t){return t&&(e._map=t),0===e.state.clusters.length?null:e.state.clusters.map((function(t){if(t.properties.cluster)return e._renderCluster(t);var r=t.properties,n=r.type,i=r.key,o=r.props;return react.createElement(n,_extends({key:i},o))}))}))},t}(react.PureComponent);_defineProperty(Cluster,"displayName","Cluster"),_defineProperty(Cluster,"defaultProps",{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64}),exports.default=Cluster;
//# sourceMappingURL=react-map-gl-cluster.cjs.js.map
